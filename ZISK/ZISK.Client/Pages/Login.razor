@page "/login"
@layout LoginLayout
@attribute [AllowAnonymous]

@inject NavigationManager Nav

<div class="login-container">
    <div class="login-card">
        <div class="login-logo">
            <div class="login-logo-text">ZISK</div>
            <div class="login-logo-subtitle">Žiarský Informačný Systém pre Kluby</div>
        </div>

        <EditForm Model="@loginModel" OnValidSubmit="HandleLogin" class="login-form">
            <DataAnnotationsValidator />

            <div class="login-field">
                <MudTextField @bind-Value="loginModel.Email"
                              Label="Email"
                              Variant="Variant.Outlined"
                              InputType="InputType.Email"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Rounded.Email"
                              For="@(() => loginModel.Email)"
                              FullWidth="true" />
            </div>

            <div class="login-field">
                <MudTextField @bind-Value="loginModel.Password"
                              Label="Heslo"
                              Variant="Variant.Outlined"
                              InputType="InputType.Password"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Rounded.Lock"
                              For="@(() => loginModel.Password)"
                              FullWidth="true" />
            </div>

            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="login-error">
                    <MudAlert Severity="Severity.Error" Dense="true">@errorMessage</MudAlert>
                </div>
            }

            <div class="login-button">
                <MudButton ButtonType="ButtonType.Submit"
                           Variant="Variant.Filled"
                           Color="Color.Primary"
                           FullWidth="true"
                           Size="Size.Large"
                           Disabled="@isLoading">
                    @if (isLoading)
                    {
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                    }
                    Prihlásiť sa
                </MudButton>
            </div>
        </EditForm>
    </div>
</div>

@code {
    private LoginModel loginModel = new();
    private string? errorMessage;
    private bool isLoading;

    private async Task HandleLogin()
    {
        isLoading = true;
        errorMessage = null;

        await Task.Delay(300);

        if (loginModel.Email == "example@example.com" && loginModel.Password == "test")
        {
            Nav.NavigateTo("/", forceLoad: true);
        }
        else
        {
            errorMessage = "Neplatný email alebo heslo.";
        }

        isLoading = false;
    }

    private sealed class LoginModel
    {
        [Required(ErrorMessage = "Email je povinný")]
        [EmailAddress(ErrorMessage = "Neplatný formát emailu")]
        public string Email { get; set; } = "";

        [Required(ErrorMessage = "Heslo je povinné")]
        [MinLength(4, ErrorMessage = "Heslo musí mať aspoň 4 znaky")]
        public string Password { get; set; } = "";
    }
}