@page "/admin/pouzivatelia"
@inject ISnackbar Snackbar
@attribute [Authorize(Roles = "Admin")]

<PageTitle>Správa používateľov</PageTitle>

<MudText Typo="Typo.h4" Class="mb-4">Správa používateľov</MudText>

<MudTable Items="@_users" Hover="true">
    <HeaderContent>
        <MudTh>Meno</MudTh>
        <MudTh>Email</MudTh>
        <MudTh>Rola</MudTh>
        <MudTh>Stav</MudTh>
        <MudTh>Akcie</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.FirstName @context.LastName</MudTd>
        <MudTd>@context.Email</MudTd>
        <MudTd>
            <MudChip T="string" Size="Size.Small" Color="@GetRoleColor(context.Role)">
                @context.Role
            </MudChip>
        </MudTd>
        <MudTd>
            @if (context.IsActive)
            {
                <MudChip T="string" Size="Size.Small" Color="Color.Success">Aktívny</MudChip>
            }
            else
            {
                <MudChip T="string" Size="Size.Small" Color="Color.Error">Neaktívny</MudChip>
            }
        </MudTd>
        <MudTd>
            <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Primary" />
            @if (context.IsActive)
            {
                <MudIconButton Icon="@Icons.Material.Filled.Block" Size="Size.Small" Color="Color.Error"
                               OnClick="@(() => ToggleStatus(context))" />
            }
            else
            {
                <MudIconButton Icon="@Icons.Material.Filled.Check" Size="Size.Small" Color="Color.Success"
                               OnClick="@(() => ToggleStatus(context))" />
            }
        </MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<UserModel> _users = new();

    protected override void OnInitialized()
    {
        // TODO: Load from API
        _users = new List<UserModel>
        {
            new() { Id = 1, FirstName = "Admin", LastName = "ZISK", Email = "admin@zisk.sk", Role = "Admin", IsActive = true },
            new() { Id = 2, FirstName = "Ján", LastName = "Novák", Email = "jan.novak@zisk.sk", Role = "Tréner", IsActive = true },
            new() { Id = 3, FirstName = "Peter", LastName = "Horváth", Email = "peter.horvath@example.com", Role = "Rodič", IsActive = true }
        };
    }

    private Color GetRoleColor(string role) => role switch
    {
        "Admin" => Color.Error,
        "Tréner" => Color.Primary,
        "Rodič" => Color.Secondary,
        _ => Color.Default
    };

    private void ToggleStatus(UserModel user)
    {
        user.IsActive = !user.IsActive;
        Snackbar.Add(user.IsActive ? "Aktivovaný" : "Deaktivovaný", Severity.Info);
    }

    private class UserModel
    {
        public int Id { get; set; }
        public string FirstName { get; set; } = "";
        public string LastName { get; set; } = "";
        public string Email { get; set; } = "";
        public string Role { get; set; } = "";
        public bool IsActive { get; set; }
    }
}