@page "/admin"
@using ZISK.Client.Services
@using ZISK.Shared.DTOs.Stats
@inject IExcusesApi ExcusesApi
@inject IStatsApi StatsApi
@inject ISnackbar Snackbar
@attribute [Authorize(Roles = "Admin")]

<PageTitle>Administrácia</PageTitle>

<MudText Typo="Typo.h4" Class="mb-4">Administrátorský panel</MudText>

@if (_isLoading)
{
    <MudProgressLinear Indeterminate="true" Color="Color.Primary" Class="mb-4" />
}
else if (_dashboardStats != null)
{
    <MudGrid Class="mb-4">
        <MudItem xs="6" sm="3">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h4" Color="Color.Warning">@_dashboardStats.PendingExcuses</MudText>
                <MudText Typo="Typo.body2">Čakajúce ospravedlnenky</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" sm="3">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h4" Color="Color.Primary">@_dashboardStats.TotalTeams</MudText>
                <MudText Typo="Typo.body2">Tímy</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" sm="3">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h4" Color="Color.Success">@_dashboardStats.ActiveMembers</MudText>
                <MudText Typo="Typo.body2">Aktívni členovia</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" sm="3">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h4" Color="Color.Info">@_dashboardStats.TotalUsers</MudText>
                <MudText Typo="Typo.body2">Používatelia</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
}

<MudText Typo="Typo.h6" Class="mb-3">Správa systému</MudText>

<MudGrid>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Large" Color="Color.Primary" />
                <MudText Typo="Typo.h6">Používatelia</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Správa účtov, aktivácia, priradenie rolí
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="/admin/pouzivatelia" FullWidth="true">
                    Spravovať
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudStack Row="true" Justify="Justify.SpaceBetween">
                    <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Large" Color="Color.Warning" />
                    @if (_dashboardStats != null && _dashboardStats.PendingExcuses > 0)
                    {
                        <MudBadge Content="@_dashboardStats.PendingExcuses" Color="Color.Error" Overlap="true">
                            <MudText></MudText>
                        </MudBadge>
                    }
                </MudStack>
                <MudText Typo="Typo.h6">Ospravedlnenky</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Schvaľovanie a správa ospravedlneniek
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Warning" Href="/admin/ospravedlnenky" FullWidth="true">
                    Skontrolovať
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Announcement" Size="Size.Large" Color="Color.Info" />
                <MudText Typo="Typo.h6">Oznamy</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Vytváranie a správa oznamov
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Info" Href="/oznamy" FullWidth="true">
                    Spravovať
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Analytics" Size="Size.Large" Color="Color.Secondary" />
                <MudText Typo="Typo.h6">Štatistiky</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Prehľady dochádzky a aktivity
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Href="/admin/statistiky" FullWidth="true">
                    Zobraziť
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Groups" Size="Size.Large" Color="Color.Tertiary" />
                <MudText Typo="Typo.h6">Tímy</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Správa tímov a členov
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Tertiary" Href="/rozvrh" FullWidth="true">
                    Zobraziť
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudStack Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Edit" Size="Size.Large" Color="Color.Success" />
                <MudText Typo="Typo.h6">Dochádzka</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Označovanie a kontrola dochádzky
                </MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Success" Href="/dochadzka" FullWidth="true">
                    Spravovať
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private bool _isLoading = true;
    private DashboardStatsDto? _dashboardStats;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            _dashboardStats = await StatsApi.GetDashboardStatsAsync();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Chyba pri načítaní štatistík: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isLoading = false;
        }
    }
}